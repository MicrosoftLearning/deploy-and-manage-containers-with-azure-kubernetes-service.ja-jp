---
Exercise:
  title: '演習: Azure Container Registry (ACR) と Azure Kubernetes Service (AKS) をプロビジョニングする'
  module: Guided Project - Deploy applications to Azure Kubernetes Service
---

# 演習 - アプリケーションを Azure Kubernetes Service (AKS) にデプロイする

## 目標

このガイド付きプロジェクトは、次の演習で構成されています。

+ **演習 1: Azure Container Registry (ACR) と Azure Kubernetes Service (AKS) をプロビジョニングする。**
+ 演習 2: Linux と Windows のコンテナー イメージをビルドし、Azure Container Registry に格納する。
+ 演習 3: コンテナー イメージを Azure Kubernetes Service にデプロイする。
+ 演習 4: デプロイを確認し、すべてのリソースのプロビジョニングを解除する。

この演習では、Azure Container Registry と Azure Kubernetes Service リソースをプロビジョニングします。
## 演習 1: Azure Container Registry (ACR) と Azure Kubernetes Service (AKS) をプロビジョニングする
この演習では、Azure コンテナー レジストリと AKS クラスターを作成します。

>**注**: この演習を完了するには、[Azure サブスクリプション](https://azure.microsoft.com/free/)が必要です。
> 指定されていないプロパティには、既定値を使用してください。

### タスク 1: Azure コンテナー レジストリを作成する
このタスクでは、Azure コンテナー レジストリを作成します

1. お使いのコンピューターから Web ブラウザー ウィンドウを開き、https://portal.azure.com で Azure portal に移動します。
1. メッセージが表示されたら、このラボで使用する Azure サブスクリプションの所有者ロールを持つユーザー アカウントを使用してログインします。 
1. Azure portal にサインインします。 
1. Azure portal の **[検索]** テキスト ボックスで、 **[コンテナー レジストリ]** を検索して選択します。
1. **[コンテナー レジストリ]** ページで、 **[+ 作成]** を選択し、次の設定を指定します。

    |設定|値|
    |---|---|
    |サブスクリプション|このラボで使用する Azure サブスクリプションの名前|
    |リソース グループ|新しいリソース グループの名前 **acr-01-RG**|
    |レジストリ名|5 から 50 文字の英数字で構成されるグローバルに一意の任意の有効な名前|
    |リージョン|Azure コンテナー レジストリと AKS クラスターを作成できる任意の Azure リージョン|
    |可用性ゾーン|**なし**|
    |SKU|**Basic**|

1. **[コンテナー レジストリ]** ページで、 **[確認 + 作成]** を選択し、 **[確認 + 作成]** タブで **[作成]** を選択します。

   > **注:** Azure コンテナー レジストリのプロビジョニングが完了するのを待たずに、次の演習に進みます。

### タスク 2: Azure 仮想ネットワークと AKS クラスターを作成する
このタスクでは、Azure 仮想ネットワークを作成し、Windows ノード プールを含む AKS クラスターをその仮想ネットワークにデプロイします。

> **注:** AKS クラスターをプロビジョニングするときに仮想ネットワークを作成できますが、これは一般的なシナリオではありません。 さらに重要なのは、AKS クラスターを既存の仮想ネットワークにデプロイするには追加の考慮事項が必要であり、それに習熟しておく必要があることです。

1. Azure portal の **[検索]** テキスト ボックスで、 **[仮想ネットワーク]** を検索して選択します。
1. **[仮想ネットワーク]** ページで **[+ 作成]** を選択し、 **[Create virtual network] (仮想ネットワークの作成)** ページの **[基本]** タブで、次の設定を指定します。

    |設定|値|
    |---|---|
    |サブスクリプション|このラボの最初の演習で選択した Azure サブスクリプションの名前|
    |リソース グループ|新しいリソース グループの名前 **aks-01-RG**|
    |仮想ネットワーク名|**vnet-01**|
    |リージョン|このラボの最初の演習で選択した同じ Azure リージョン|

1. **[Create virtual network] (仮想ネットワークの作成)** ページの **[基本]** タブで、 **[次へ]** を選択します。
1. **[Create virtual network] (仮想ネットワークの作成)** ページの **[セキュリティ]** タブで、既定の設定をそのまま使用し、 **[次へ]** を選択します。
1. **[Create virtual network] (仮想ネットワークの作成)** ページの **[IP アドレス]** タブで、IP アドレス空間が **10.0.0.0/16** に設定されていることを確認し、**既定**のサブネットを削除します。次に、 **[確認 + 作成]** を選択し、 **[確認 + 作成]** タブで **[作成]** を選択します。

   > **注:** 仮想ネットワークの作成には数秒しかかからないため、次の手順に直接進むことができます。

1. Azure portal の **[検索]** テキスト ボックスで、 **[Kubernetes サービス]** を検索して選択します。
1. **[Kubernetes サービス]** ページで **[+ 作成]** を選択し、ドロップダウン リストで **[Kubernetes クラスターの作成]** を選択して、 **[Kubernetes クラスターの作成]** ページの **[基本]** タブで、次の設定を指定します。

    |設定|値|
    |---|---|
    |サブスクリプション|このラボの最初の演習で選択した Azure サブスクリプションの名前|
    |リソース グループ|**aks-01-RG**|
    |クラスターのプリセット構成|**Dev/Test**|
    |Kubernetes クラスター名|**aks-01**|
    |リージョン|このラボの最初の演習で選択した同じ Azure リージョン|
    |可用性ゾーン|**なし**|
    |AKS 価格レベル|**Free**|
    |Kubernetes バージョン|既定値をそのまま使用します|
    |自動アップグレード|無効|
    |ノード サイズ|**Standard B4ms**|
    |スケーリング方法|**[手動]**|
    |ノード数|**2**|

   > **注:** ノード サイズとノード数の値に合わせて、vCPU クォータを増やすか、VM SKU を変更することが必要な場合があります。 vCPU クォータを増やす手順については、Microsoft Learn の記事「[VM ファミリの vCPU クォータの増加](https://learn.microsoft.com/en-us/azure/quotas/per-vm-quota-requests)」を参照してください。

1. **[Kubernetes クラスターの作成]** ページの **[基本]** タブで、 **[次へ: ノード プール >]** を選択します。
1. **[Kubernetes クラスターの作成]** ページの **[ノード プール]** タブで、 **[次へ: アクセス >]** を選択します。
1. **[Kubernetes クラスターの作成]** ページの **[アクセス]** タブで、 **[次へ: ネットワーク >]** を選択します。
1. **[Kubernetes クラスターの作成]** ページの **[ネットワーク]** タブで、 **[Azure CNI]** オプションを選択し、 **[仮想ネットワーク]** ドロップダウン リストで **[vnet-01]** を選択して、 **[クラスター サブネット]** ボックスの下にある **[Managed subnet configuration] (マネージド サブネット構成)** を選択します。
1. **[vnet-01 \| サブネット]** ページで **[+ サブネット]** を選択します。
1. **[サブネットの追加]** ページで、次の設定を指定して、 **[保存]** を選択します。

    |設定|値|
    |---|---|
    |名前|**aks-subnet**|
    |サブネットのアドレス範囲|**10.0.0.0/20**|

1. **[vnet-01 \| サブネット]** ページに戻り、ページの左上部分の階層リンクの軌跡で、 **[Kubernetes クラスターの作成]** を選択します。 
1. **[Kubernetes クラスターの作成]** ページの **[ネットワーク]** タブに戻り、次の設定を指定します。

    |設定|値|
    |---|---|
    |クラスター サブネット|**aks-subnet (10.0.0.0/20)**|
    |Kubernetes サービスのアドレス範囲|**172.16.0.0/22**|
    |Kubernetes DNS サービスの IP アドレス|**172.16.3.254**|
    |DNS 名プレフィックス|**aks-01-dns**|
    |プライベート クラスターの有効化|無効|
    |承認された IP 範囲の設定|無効|
    |ネットワーク ポリシー|**なし**|

1. **[Kubernetes クラスターの作成]** ページの **[ネットワーク]** タブで、 **[ノード プール]** タブを選択します。

   > **注:** クラスターに Windows ノード プールを追加します。 これには、ネットワーク構成を既定の **Kubenet** から **Azure CNI** に変更する必要がありました。 Kubenet ネットワーク構成では、Windows ノード プールはサポートされません。

1. **[Kubernetes クラスターの作成]** ページの **[ノード プール]** タブで、 **[+ ノード プールの追加]** を選択します。
1. **[ノード プールの追加]** ページで、次の設定を指定します。

    |設定|値|
    |---|---|
    |ノード プール名|**w1pool**|
    |モード|**ユーザー**|
    |OS の種類|**Windows**|
    |可用性ゾーン|**なし**|
    |Azure Spot インスタンスを有効にする|無効|
    |ノード サイズ|**Standard B4s_v2**|
    |スケーリング方法|**[手動]**|
    |ノード数|**2**|
    |ノードごとの最大ポッド数|**30**|
    |ノードごとにパブリック IP を有効にする|無効|

   > **注:** ノード サイズとノード数の値に合わせて、vCPU クォータを増やすか、VM SKU を変更することが必要な場合があります。 vCPU クォータを増やす手順については、Microsoft Learn の記事「[VM ファミリの vCPU クォータの増加](https://learn.microsoft.com/en-us/azure/quotas/per-vm-quota-requests)」を参照してください。

1. **[ノード プールの追加]** ページで、 **[追加]** を選択します。
1. **[Kubernetes クラスターの作成]** ページの **[ノード プール]** タブで、 **[統合]** タブを選択します。
1. **[Kubernetes クラスターの作成]** ページの **[統合]** タブの **[コンテナー レジストリ]** ドロップダウン リストで、前の演習で作成した Azure コンテナー レジストリを表すエントリを選択し、 **[Enable recommended alert rules] (推奨されるアラート ルールを有効にする)** チェック ボックスをオフにします。次に、 **[Azure Policy]** オプションが無効になっていることを確認して、 **[確認 + 作成]** を選択します。
1. **[Kubernetes クラスターの作成]** ページの **[確認 + 作成]** タブで、 **[作成]** を選択します。

   > **注:** AKS クラスターのプロビジョニングが完了するのを待たずに、次の演習に進みます。 プロビジョニング プロセスには約 5 分かかる場合があります。
